define(["backbone","models/loader","text!templates/tripSelect.html","text!templates/tripResponse.html"],function(e,t,r,i){var s=e.View.extend({el:"#tripsorter",departures:[],arrivals:[],departure:"",arrival:"",tripMode:"fast",service:null,json:null,template:null,initialize:function(){that=this,this.service=new t,this.service.on("change:ready",function(){that.departures=that.service.getCities().toJSON(),that.showSelectTrip()})},events:{"change #departure":"setDeparture","change #arrival":"setArrival","click #cheapmode":"setCheapMode","click #fastmode":"setFastMode","click #search":"showResult","click #reset":"showSelectTrip"},setDeparture:function(e){var t=this,r=0;_.each(this.departures,function(i){i.cid!==e.target.value?(i.selected=!1,t.arrivals[r]=i,r++):i.selected=!0}),this.departure=e.target.value,this.arrival="",this.showSelectTrip()},setArrival:function(e){this.arrival=e.target.value,this.showSelectTrip()},setCheapMode:function(){this.tripMode="cheap",this.showSelectTrip()},setFastMode:function(){this.tripMode="fast",this.showSelectTrip()},showSelectTrip:function(){this.json={mode:this.tripMode,departures:this.departures,arrivals:this.arrivals,departure:this.departure,arrival:this.arrival},this.template=_.template(r),this.render()},showResult:function(){""!=this.arrival&&""!=this.departure&&(this.json=this.service.getTrip(this.departure,this.arrival,this.tripMode).getDetailToJSON(),this.template=_.template(i),this.render())},render:function(){return this.$el.html(this.template({json:this.json})),this}});return s});