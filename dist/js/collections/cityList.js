define(["backbone","models/city","models/trip"],function(e,t,n){var i=e.Collection.extend({getByName:function(e){return this.find(function(t){return t.getName()===e})},insert:function(e){return exists=this.getByName(e.getName()),null==exists?(this.add(e),e):exists},getTrip:function(e,t,i){var a=this,r=this.get(e),g=this.get(t),u=new n({departure:r,arrival:g}),s=u;return getStep=function(e){if(e.matching(s.getRelevance()))(e.getRelevance()<s.getRelevance()||null==s.getRelevance())&&(s=e);else if(!e.isBad()){var t=a.getByName(e.getCurrentStep().getName()),u=t.getDestinations();u.each(function(t){newRoute=new n({departure:r,arrival:g,relevance:e.getRelevance()}),newRoute.setTraveled(e.getTraveled()),newRoute.addStep(t,i),getStep(newRoute)})}},getStep(u),s}});return i});